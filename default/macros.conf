[channel]
definition = | eval http_channel=if(http_referer="-","Direct", if(http_referer_domain==settings_site,"Direct", if(isnull(http_channel), "Referal", http_channel))) | eval http_session_channel=if(http_session_referrer="-","Direct", if(http_session_referrer_domain==settings_site,"Direct", if(isnull(http_session_channel) AND isnotnull(http_session), "Referal", http_session_channel)))
iseval = 0

[analytics(2)]
args = attribute,site
definition = tstats summariesonly=t max(Web.http_session_pageviews) AS http_session_pageviews,max(Web.http_session_duration) AS http_session_duration,first(Web.$attribute$) AS $attribute$ FROM datamodel=Web WHERE Web.site="$site$" "Web.eventtype"=pageview GROUPBY Web.http_session | stats count(eval(http_session_pageviews=1)) AS Bounces, count(eval(http_session_pageviews>1)) AS NonBounces,avg(http_session_pageviews) AS "Pages/Session", avg(http_session_duration) AS "Avg. Session Duration", count AS Sessions, sum(http_session_pageviews) AS Pageviews, sum(http_session_duration) AS Duration by $attribute$ | eval "Bounce rate"=round(100*(Bounces/(Bounces+NonBounces)),2) | fields $attribute$ "Bounce rate" "Pages/Session" "Avg. Session Duration" Sessions Pageviews Duration Bounces NonBounces | eval "Bounce rate"='Bounce rate'."%" | eval "Pages/Session"=round('Pages/Session',2) | eval "Avg. Session Duration"=round('Avg. Session Duration',2) | eventstats sum(Sessions) as TotalSessions |  eval "% Sessions"=round((Sessions/TotalSessions)*100,2) | eval "% Sessions"='% Sessions'."%"  | appendpipe [stats sum(Sessions) AS Sessions, sum(Pageviews) as Pageviews, sum(Duration) as Duration, sum(Bounces) as Bounces, sum(NonBounces) as NonBounces |  eval "Pages/Session"=round(Pageviews/Sessions,2) | eval "Avg. Session Duration"=round(Duration/Sessions,2)|  eval "Bounce rate"=round(100*(Bounces/(Bounces+NonBounces)),2)."%" | eval "% Sessions"=round((Sessions/Sessions)*100,2) | eval "% Sessions"='% Sessions'."%" | eval $attribute$="Total"] | fields $attribute$ Sessions "% Sessions" Pageviews "Bounce rate" "Pages/Session" "Avg. Session Duration"
iseval = 0


[analytics_goal(3)]
args = attribute,goal,site
definition = tstats summariesonly=t count first(Web.$attribute$) AS $attribute$ FROM datamodel=Web WHERE Web.site="$site$" "Web.eventtype"=pageview GROUPBY _time span=1d, Web.http_session,Web.uri,Web.site | eval goal_id="goal_$goal$" | rename Web.uri AS uri | lookup WA_goals site AS Web.site goal_id AS goal_id OUTPUT start as goal_start end as goal_end | stats dc(Web.http_session) AS Sessions, count(eval(uri=goal_start)) AS Entries,count(eval(uri=goal_end)) AS Completed by $attribute$ | eval "Conversion Rate"=round(100*(Completed/Sessions),2) | eval CompletionRate=round(100*(Completed/Entries),2) | appendpipe [stats sum(Sessions) AS Sessions, sum(Completed) AS Completed  |  eval "Conversion Rate"=round(100*(Completed/Sessions),2) | eval $attribute$="Total" ]| fields $attribute$ Completed "Conversion Rate" | eval "Conversion Rate"='Conversion Rate'."%" | rename Completed AS "Completed (Goal $goal$)","Conversion Rate" AS "Conversion Rate (Goal $goal$)"
iseval = 0

